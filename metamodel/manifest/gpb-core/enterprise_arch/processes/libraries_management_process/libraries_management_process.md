# Процесс управления библиотеками

## Предпосылки
На текущий момент в ГПБ разрабатывается большое количество приложений с собственной кодовой базой. При этом команды часто решают типовые задачи собственными ресурсами, что приводит к увеличению операционных расходов.

С целью сокращения операционных расходов, необходимо организовать процесс использования существующих наработок типовых решений. Для этого командам необходимо выделять переиспользуемый код в *библиотеки*.

*Библиотека* - это переиспользуемый код, оформленный в виде отдельного тиражируемого компонента. При этом библиотека может иметь свои зависимости от других библиотек.


## Классификация
Используемые в ГК библиотеки классифицируются по двум критериям: возможность изменения кода и регламентируемость использования.

### Возможность изменения кода

#### Внутреннняя разработка (`inhouse`)
Развитие и поддержка библиотеки ведется силами ГПБ. Кодовая база находится в корпоративном репозитории или в публичном репозитории, владельцем которого является **корпоративная учетная запись**.

#### Стороняя разработка (`external`)
Проприетарная или open-source библиотека, которая развивается и распространяется сторонней организацией или открытым сообществом. Код принимается как есть, даже если есть возможность локально изменять код библиотеки. Если есть необходимость локально внести исправления в код сторонней библиотеки она должна быть переклассифицирована во внутреннюю разработку.


### Регламентируемость использования

#### Регламентируемая (`regulated`)
Использование библиотеки имеет влияние на общий ИТ-ландшафт и ее использование *регламентируется* стандартами ГК.

#### Свободно используемая (`opened`)
Использование носит *рекомендательный* характер. Поощряется локальный open-source на уровне ГК ([inner-source](https://en.wikipedia.org/wiki/Inner_source)).


## Роли
В процессе управления библиотеками выделяются следующие роли:
- **Mentor** - роль, определяющая вектор развития и занимающаяся популяризацией библиотеки в ГК.
- **Maintainer** - роль, выполняющая внесение изменений в кодовую базу библиотеки.
- **Contributor** - роль, предлагающая изменения кодовой базы библиотеки. Может быть любой сотрудник ГК, в том числе Maintainer.
- **Team** - роль, обеспечивающая внедрение и корректную эксплуатацию библиотеки в продукте, а так же отвечающая за исполнение требований процесса управления библиотеками.


## Требования
1. Все библиотеки должны быть размещены во внутреннем контуре разработки ГПБ. Соответственно, все внутренние библиотеки, разработка которых ведется в публичных репозиториях, должны иметь зеркало в корпоративной системе контроля версий. Все сторонние библиотеки должны "зеркалироваться" на внутренних ресурсах компании.
2. Все библиотеки должны быть размещены с публичным уровнем доступа.
3. Все внутренние и регламентируемые библиотеки должны быть описаны в DocHub как отдельные сущности.
4. Правила использования регламентируемых библиотек в обязательном порядке должны быть описаны в стандарте с типом *Использование библиотеки*.
5. За каждой библиотекой должна быть закреплена роль `Maintainer`. Для регламентируемых библиотек и библиотек внутренней разработки дополнительно должен быть назначен `Mentor`. Описание ответственностей ролей можно посмотреть в [Ответственность](#ответственность).

Детали реализации требований см. в [Руководстве по управлению библиотеками ГПБ](/docs/dochub.libraries_guide).


## Ответственность

### Внесение изменений в библиотеку
Предлагать изменения к библиотеке внутренней разработки может любой сотрудник компании в виде merge request (роль `Contributor`). Для **регламентируемой** библиотеки предложенные изменения, должны пройти предварительное одобрение со стороны роли `Mentor`.

### Контроль качества кода библиотеки
Все библиотеки требуют проведения процедуры контроля качества кода. Контроль качества кода и непосредственный перенос изменений в основную ветку лежит на роле `Maintainer`.

### Использование библиотеки
Роль `Mentor` отвечает за поддержание стандарта использования библиотеки - определяет версии, которые допускается использовать, актуализирует стандарт и несет ответственность за риски, возникающие при использовании библиотеки. Cоответственно, Mentor заинтересован в том, чтобы своевременно закрывать уязвимости и распространять новые версии библиотеки.

Роль `Team` отвечает за своевременное внедрение новой версии и корректное использование регламентируемой библиотеки в продукте. Если для решения конкретной задачи в компании уже есть регламентируемая библиотека, то команда обязана использовать только ее, в соответствии со стандартом.

Роль `Team` самостоятельно принимает решение об использовании нерегламентированных библиотек без какого-либо дополнительного согласования, и полностью принимает на себя ответственность за риски ее использования.

### Исправление ошибок
Исправление ошибок происходит таким же образом, как и любые другие изменения - предложить исправление может любой сотрудник в виде merge request (см. [Внесение изменений в библиотеку](#внесение-изменений-в-библиотеку)).

Внесение локальных изменений (в рамках только своего проекта) в код библиотеки **запрещено**.


## Вместо заключения
Как уже было сказано выше, библиотеки помогают экономить время разработки, поэтому старайтесь любой потенциально переиспользуемый код выносить в библиотеки. При этом не ограничивайте себя в желании сделать мир лучше и вносите правки в уже существующие библиотеки.